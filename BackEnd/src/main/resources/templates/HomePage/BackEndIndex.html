<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>數據分析 - DINEEASE餐廳管理系統</title>

	<!-- Favicon -->
	<link rel="icon" th:href="@{/images/favicon.ico}" />

	<!-- Google Fonts -->
	<link rel="preconnect" href="https://fonts.googleapis.com" />
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
	<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@100..900&display=swap" rel="stylesheet" />

	<!-- Font Awesome -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />

	<!-- DataTables -->
	<link rel="stylesheet" href="https://cdn.datatables.net/2.1.8/css/dataTables.dataTables.css" />

	<!-- Custom CSS -->
	<link rel="stylesheet" th:href="@{/css/demo.css}" />

	<!-- JavaScript Libraries -->
	<script th:src="@{/jquery/jquery-3.7.1.js}"></script>
	<script src="https://cdn.datatables.net/2.1.8/js/dataTables.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>

	<style>
		/* 主要容器樣式 */
		.stats-container {
			display: flex;
			justify-content: space-between;
			padding: 20px;
			gap: 20px;
			width: 100%;
			margin: 0 auto;
		}

		.stat-card {
			background: white;
			border-radius: 12px;
			padding: 24px;
			flex: 1;
			min-width: 200px;
			box-shadow: 0 2px 8px rgba(0,0,0,0.1);
			border: 1px solid #e0e0e0;
			transition: transform 0.2s;
			display: flex;
			flex-direction: column;
			align-items: center;
		}

		.stat-card:hover {
			transform: translateY(-5px);
		}

		.stat-icon {
			font-size: 2.5rem;
			color: #0071e3;
			margin-bottom: 15px;
		}

		.stat-info {
			text-align: center;
		}

		.stat-info h3 {
			margin: 0;
			font-size: 1.2rem;
			color: #666;
			font-weight: 500;
		}

		.stat-info p {
			margin: 10px 0 0;
			font-size: 2rem;
			font-weight: bold;
			color: #333;
		}

		/* 圖表容器樣式 */
		.charts-container {
			display: grid;
			grid-template-columns: repeat(2, 1fr);
			gap: 20px;
			padding: 20px;
			width: 100%;
			margin: 0 auto;
		}

		.chart-wrapper {
			background: white;
			border-radius: 12px;
			padding: 20px;
			box-shadow: 0 2px 8px rgba(0,0,0,0.1);
			border: 1px solid #e0e0e0;
			height: 400px;
			width: 100%;

		}

		.chart-wrapper:last-child {
			grid-column: 1 / -1;
		}
		/* 調整頁面整體布局 */
		#page {
			display: flex;
			min-height: 100vh;
			width: 100%;
		}
		/* 清除可能的多餘邊距 */
		body {
			margin: 0;
			padding: 0;
			background-color: white;
		}

		/* 修改 #right 樣式 */
		#right {
			flex: 1;
			background-color: white;
			width: 100%;
			min-height: 100vh;
			overflow-x: hidden;
		}

		#memberPieChart,
		#revenueChart,
		#topDishesChart {
			width: 100%;
			height: 100%;
		}

		/* 主要區塊樣式 */
		main {
			padding: 20px;
			background-color: white; /* 改為白色背景 */
			min-height: 100%;
			width: 100%;
		}

		/* 響應式設計 */
		@media (max-width: 900px) {
			.stats-container {
				flex-direction: column;
			}

			.charts-container {
				grid-template-columns: 1fr;
			}

			.chart-wrapper {
				height: 300px;
			}
		}
	</style>
</head>

<body>
<div id="page">
	<div th:replace="~{layout/navbar}"></div>
	<div id="right">
		<div th:replace="~{layout/headerlogout.html}"></div>

		<main>
			<!-- 統計卡片區域 -->
			<div class="stats-container">
				<div class="stat-card">
					<div class="stat-icon">
						<i class="fas fa-users"></i>
					</div>
					<div class="stat-info">
						<h3>會員總數</h3>
						<p id="memberCount">0</p>
					</div>
				</div>

				<div class="stat-card">
					<div class="stat-icon">
						<i class="fas fa-dollar-sign"></i>
					</div>
					<div class="stat-info">
						<h3>本月營收</h3>
						<p id="monthlyRevenue">0</p>
					</div>
				</div>

				<div class="stat-card">
					<div class="stat-icon">
						<i class="fas fa-shopping-cart"></i>
					</div>
					<div class="stat-info">
						<h3>本月訂單數</h3>
						<p id="monthlyOrders">0</p>
					</div>
				</div>
			</div>

			<!-- 圖表區域 -->
			<div class="charts-container">
				<div class="chart-wrapper">
					<div id="memberPieChart"></div>
				</div>
				<div class="chart-wrapper">
					<div id="revenueChart"></div>
				</div>
				<div class="chart-wrapper">
					<div id="topDishesChart"></div>
				</div>
			</div>
		</main>
	</div>
</div>

<script>
	document.addEventListener('DOMContentLoaded', function() {
		// 初始化所有圖表
		const memberPieChart = echarts.init(document.getElementById('memberPieChart'));
		const revenueChart = echarts.init(document.getElementById('revenueChart'));
		const topDishesChart = echarts.init(document.getElementById('topDishesChart'));

		// 會員性別分布圖表配置
		const memberPieOption = {
			title: {
				text: '會員性別分布',
				left: 'center'
			},
			tooltip: {
				trigger: 'item'
			},
			legend: {
				orient: 'horizontal',
				bottom: 'bottom'
			},
			series: [{
				name: '會員性別',
				type: 'pie',
				radius: '50%',
				data: [
					{ value: 11, name: '男性', itemStyle: { color: '#66b3ff' } },
					{ value: 9, name: '女性', itemStyle: { color: '#ff9999' } }
				],
				emphasis: {
					itemStyle: {
						shadowBlur: 10,
						shadowOffsetX: 0,
						shadowColor: 'rgba(0, 0, 0, 0.5)'
					}
				}
			}]
		};

		// 本月營收趨勢圖表配置
		const revenueOption = {
			title: {
				text: '本月營收趨勢',
				left: 'center'
			},
			tooltip: {
				trigger: 'axis'
			},
			xAxis: {
				type: 'category',
				data: ['1日', '2日', '3日', '4日', '5日', '6日', '7日'] // 示例數據
			},
			yAxis: {
				type: 'value',
				name: '營收（元）'
			},
			series: [{
				name: '營收',
				type: 'line',
				smooth: true,
				data: [3000, 4500, 5000, 4000, 6000, 5500, 7000], // 示例數據
				itemStyle: {
					color: '#0071e3'
				},
				areaStyle: {
					color: {
						type: 'linear',
						x: 0,
						y: 0,
						x2: 0,
						y2: 1,
						colorStops: [{
							offset: 0,
							color: 'rgba(0,113,227,0.3)'
						}, {
							offset: 1,
							color: 'rgba(0,113,227,0.1)'
						}]
					}
				}
			}]
		};

		// 熱門餐點排行圖表配置
		const topDishesOption = {
			title: {
				text: '本月熱門餐點排行',
				left: 'center'
			},
			tooltip: {
				trigger: 'axis',
				axisPointer: {
					type: 'shadow'
				}
			},
			xAxis: {
				type: 'category',
				data: ['牛排', '義大利麵', '漢堡', '沙拉', '披薩'], // 示例數據
				axisLabel: {
					interval: 0,
					rotate: 30
				}
			},
			yAxis: {
				type: 'value',
				name: '銷售數量'
			},
			series: [{
				name: '銷售量',
				type: 'bar',
				data: [120, 100, 80, 70, 60], // 示例數據
				itemStyle: {
					color: '#0071e3'
				}
			}]
		};

		// 設置圖表配置
		memberPieChart.setOption(memberPieOption);
		revenueChart.setOption(revenueOption);
		topDishesChart.setOption(topDishesOption);

		// 獲取數據的函數
		async function fetchDashboardData() {
			try {
				const response = await fetch('/api/dashboard');
				const data = await response.json();

				// 更新統計卡片
				document.getElementById('memberCount').textContent = data.totalMembers || 0;
				document.getElementById('monthlyRevenue').textContent = `$${(data.monthlyRevenue || 0).toLocaleString()}`;
				document.getElementById('monthlyOrders').textContent = data.monthlyOrders || 0;

				// 更新圖表數據
				if (data.genderDistribution) {
					memberPieChart.setOption({
						series: [{
							data: data.genderDistribution
						}]
					});
				}

				if (data.revenueData) {
					revenueChart.setOption({
						xAxis: {
							data: data.revenueData.dates
						},
						series: [{
							data: data.revenueData.values
						}]
					});
				}

				if (data.topDishes) {
					topDishesChart.setOption({
						xAxis: {
							data: data.topDishes.names
						},
						series: [{
							data: data.topDishes.values
						}]
					});
				}
			} catch (error) {
				console.error('獲取儀表板數據失敗:', error);
			}
		}

		// 初始加載數據
		fetchDashboardData();

		// 設置定時更新
		setInterval(fetchDashboardData, 60000); // 每分鐘更新一次

		// 響應式處理
		window.addEventListener('resize', function() {
			memberPieChart.resize();
			revenueChart.resize();
			topDishesChart.resize();
		});
	});
</script>
</body>
</html>